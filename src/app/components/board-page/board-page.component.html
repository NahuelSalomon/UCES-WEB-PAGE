<div class="card">
  <div class="card-body">

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a [ngClass]="{'active': !recommendationIsSelected, 'nav-link' : true}" (click)="changeForumType()">
          Consultas
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" [ngClass]="{'active': recommendationIsSelected, 'nav-link' : true}"
          (click)="changeForumType()">
          Recomendaciones
        </a>
      </li>
    </ul>


    <div *ngIf="forumList">
      <div *ngFor="let forum of forumList">
        <br>
        <div class="card">
          <div class="card-body card-body-forum">
             <div class="row">
                <div class="col-8"><h5 class="card-title">{{ forum.user.firstname }} {{ forum.user.lastname }}</h5></div>
                <div class="col-4 text-end" style="font-size: 14px;">{{ forum.date[2] }}-{{ forum.date[1] }}-{{ forum.date[0] }} <!-- {{ forum.date[3] }}:{{ forum.date[4] }}:{{ forum.date[5] }} --></div>
              </div>
            <p class="card-text">{{ forum.body }}</p>
          </div>
          <!-- <hr class="mb-mt-0 mr-ml-16" /> -->
          <div class="interaction-btns text-end mr-ml-16">
            <div *ngIf="!recommendationIsSelected" style="display: inline-block;">
              <button class="btn btn-light btn-secu mb-0" (click)="responseQuery(forum)"><i class="fa-regular fa-comment-dots" ></i> Responder</button>
              <p class="d-in-block mb-0"> · </p>
              <button class="btn btn-light btn-transparent mb-0" *ngIf="forum.responses" (click)="showQueryResponsesForum(forum)">{{forum.responses.length}}
                Respuestas <i *ngIf="isEnabledQueryResponsesControl(forum)" class="fa-regular fa-square-caret-up"></i>
                           <i *ngIf="!isEnabledQueryResponsesControl(forum)" class="fa-regular fa-square-caret-down"></i>
                </button>
              <p class="d-in-block mb-0 pd-6-12"><i class="fa-solid fa-grip-lines-vertical"></i></p>
            </div>
            <button class="btn btn-light btn-secu mb-0" (click)="voteUnVoteForum(forum)">
              <i [ngClass]="forumRecommendedByTheLoggedUser(forum) ? 'fa-solid fa-thumbs-up' : 'fa-regular fa-thumbs-up' " style="margin-bottom: 0px !important;"></i> Recomendar
            </button>
            <p class="d-in-block mb-0"> · </p>
            <button class="btn btn-light btn-transparent mb-0">{{ forum.usersWhoVoted.length }} recomendaciones</button>
          </div>
          <div *ngIf="!recommendationIsSelected && forum.responses && isEnabledQueryResponsesControl(forum)">
            <div class="col-12">
              <hr class="mb-mt-0 mr-ml-16" />
            </div>


            <div class="row">


              <div class="col-1"></div>
              <div class="col-11">

                <!-- <div *ngIf="userType == 'ROLE_STUDENT'"> -->
     
                    
                    <form [formGroup]="responseQueryForm">
                      <div class="row" style="padding-top: 16px;">
                    <div class="col-11">
                      <div class="mb-3" >
                        <textarea class="form-control custom-text-area" id="bodyQueryResponse{{forum.id}}" formControlName="bodyQueryResponse{{forum.id}}" id="forumBody" rows="2" f placeholder="Escriba aquí una respuesta..."></textarea>
                      </div>
                    </div>
                    <div class="col-1">
                      <div class="text-end"><button  class="btn btn-success" [disabled]="!isQueryResponseValid(forum.id)" (click)="addResponseQuery(forum)"><i class="fa-solid fa-circle-chevron-right"></i></button></div>
                    </div>
                  </div>
                  </form>
                   
         
                
               <!--  </div> -->

                <div *ngFor="let response of forum.responses">
                  <div class="card-response-query">
                    <div class="card-body card-body-forum bg-light-blue">
                      <h5 class="card-title">{{ response.user.firstname }} {{ response.user.lastname }}</h5>
                      <p class="card-text">{{ response.body }}</p>
                    </div>
                  </div>
                </div>
    
              </div>
            </div>



          </div>

        </div>


      </div>
    </div>


    <br>
    <br>
    <div *ngIf="userType == 'ROLE_STUDENT'">
      <form [formGroup]="forumForm">

        
      <div class="mb-3">
        <textarea formControlName="body" placeholder="Crear foro" class="form-control" id="forumBody" rows="2"></textarea>
      </div>
      <div class="text-end"><button class="btn btn-success" [disabled]="!body.valid" (click)="addForum()">Agregar</button></div>
    </form>
    </div>

  </div>

  <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
    <ngb-toast class="success-alert" *ngIf="showToastSuccess" [delay]="2000" [autohide]="true"
      (hidden)="showToastSuccess=false">
      <b style="font-weight: 500;"><i class="fa-solid fa-circle-check"></i> {{textToastSuccess}}</b>
    </ngb-toast>
    <ngb-toast class="error-alert" *ngIf="showToastError" [delay]="2000" [autohide]="true"
      (hide)="showToastError=false">
      <b style="font-weight: 500;"><i class="fa-solid fa-circle-xmark"></i> {{textToastError}}</b>
    </ngb-toast>
  </div>

</div>